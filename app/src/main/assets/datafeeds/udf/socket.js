var ws,isopen,timer,socket,c,send;function f(t){clearInterval(timer);function s(){if(ws&&ws.readyState==1){t(ws)}}s();timer=setInterval(function(){s()},5000)};function connectSocketServer(s){var support="MozWebSocket"in window?'MozWebSocket':("WebSocket"in window?'WebSocket':null);if(support==null){alert("* "+noSupportMessage+"<br/>");return}if(!s){return}ws=new window[support](s);ws.onmessage=function(evt){var data=$.parseJSON(evt.data);clearInterval(timer);clearTimeout(ws.timerOut);ws.timerOut=setTimeout(function(){ws.close()},20000);var type=data.type||'';switch(type){case'ping':ws.send('{"type":"ping"}');break;default:c&&c(type,data.data)}};ws.onopen=function(){isopen=true;f(send)};ws.onclose=function(){isopen=false;setTimeout(function(){connectSocketServer(socket)},1000)}};var obj= {set:function(s,callbak,t){socket=s;connectSocketServer(socket);c=callbak;send=t}}